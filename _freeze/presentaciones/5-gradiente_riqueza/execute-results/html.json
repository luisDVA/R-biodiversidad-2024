{
  "hash": "fb9df064f08b820eadf28d19338d41e8",
  "result": {
    "markdown": "---\ntitle: \"Patrones geográficos de riqueza de especies\"\nauthor: Fabricio Villalobos\ninstitute: Instituto de Ecología, A.C. - INECOL\nformat:\n  revealjs:\n    theme: curso_styles.scss\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n## Áreas de distribución y patrones geográficos de riqueza\n\n> \"To do science is to search for repeated patterns, not simply to accumulate facts\" R. MacArthur\n\n\n-   A partir de las distribuciones geográficas de las especies es posible describir y evaluar diferentes patrones de biodiversidad que emergen cuando estudiamos conjuntos de especies (y no a nivel indivual)\n\n## Áreas de distribución y patrones geográficos de riqueza\n\n-   En este ejercicio veremos cómo usar las distribuciones de las especies (polígonos, como los que generamos en el ejercicio anterior) para generar el patrón geográfico de riqueza de especies\n\n\n## \n\nLos datos (polígonos) son del orden PRIMATES (MAMMALIA) obtenidos de la [IUCN](https://www.iucnredlist.org/)\n\n## Paquetes necesarios:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(letsR)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(viridisLite)\nlibrary(tmap)\nlibrary(here)\n```\n:::\n\n\n# letsR (Vilela & Villalobos 2015 MEE)\n\n## \n\nCargar los polígonos de las especies de interés (shapefiles en su carpeta de trabajo)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprimates_maps <- st_read(here(\"dados\",\"primates_maps.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `primates_maps' from data source \n  `/home/luisd/Dropbox/darcyDB/PDRF/R-biodiversidad-2024/dados/primates_maps.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 915 features and 28 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99.2274 ymin: -34.83983 xmax: 141.9292 ymax: 41.54623\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\n. . .\n\nConocer el dominio (\"extent\") de los datos, para usarlo después en la delimitación del espacio (geográfico) de trabajo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_bbox(primates_maps)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     xmin      ymin      xmax      ymax \n-99.22740 -34.83983 141.92917  41.54623 \n```\n:::\n:::\n\n\n\n## \n\nCrear una matriz de presencia-ausencia a partir de los polígonos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprimates.pam <- lets.presab(primates_maps, xmn = -100,xmx = 141, ymn = -35, ymx = 42, resol=1, count=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |=========                                                             |  14%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |=======================                                               |  34%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |=====================================                                 |  54%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |=================================================                     |  71%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |===================================================                   |  74%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |=================================================================     |  94%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n\n## ¿Cómo se ve el patrón geográfico?\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(primates.pam)\n```\n\n::: {.cell-output-display}\n![](5-gradiente_riqueza_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n## \n\n¿Qué tiene el objeto que se graficó?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprimates.pam$Richness_Raster\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass       : SpatRaster \ndimensions  : 77, 241, 1  (nrow, ncol, nlyr)\nresolution  : 1, 1  (x, y)\nextent      : -100, 141, -35, 42  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=longlat +datum=WGS84 +no_defs \nsource(s)   : memory\nname        : lyr.1 \nmin value   :     0 \nmax value   :    33 \n```\n:::\n:::\n\n\n## \n\nVamos a verlo en `ggplot`\n\n. . .\n\nPrimero, convertimos el raster en un `data.frame`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdf <- as.data.frame(primates.pam$Richness_Raster, xy=TRUE) #Convert raster to data.frame\nnames(rdf)[3] <- 'richness' #Name value column\nhead(rdf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      x    y richness\n1 -99.5 41.5        0\n2 -98.5 41.5        0\n3 -97.5 41.5        0\n4 -96.5 41.5        0\n5 -95.5 41.5        0\n6 -94.5 41.5        0\n```\n:::\n\n```{.r .cell-code}\nrdf2 <- rdf\nrdf2[,3] <- ifelse(rdf[,3]==0,NA,rdf[,3])\nhead(rdf2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      x    y richness\n1 -99.5 41.5       NA\n2 -98.5 41.5       NA\n3 -97.5 41.5       NA\n4 -96.5 41.5       NA\n5 -95.5 41.5       NA\n6 -94.5 41.5       NA\n```\n:::\n:::\n\n\n## \n\nAhora sí, lo graficamos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = rdf2)+\n  geom_raster(mapping=aes(x=x, y=y, fill=richness))+\n  scale_fill_gradientn(colours= rev(inferno(10)), name='Richness')\n```\n\n::: {.cell-output-display}\n![](5-gradiente_riqueza_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n##\n\n¿Qué más podemos hacer con esto?\n\n. . . \n\nPor ejemplo, relacionar el patrón de riqueza con alguna variable ambiental \n\n. . .\n\nCarguemos una variable ambiental (temperatura máxima, que viene de [WorldClim](https://www.worldclim.org))\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp <- rast(here(\"dados\",\"bio1.bil\"))\n\nplot(temp)\n```\n:::\n\n\n##\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp <- rast(here(\"dados\",\"bio1.bil\"))\n\nplot(temp)\n```\n\n::: {.cell-output-display}\n![](5-gradiente_riqueza_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n##\n\nAhora, podemos extraer ambos valores/variables de interés: riqueza y temperatura\n\n¿Cómo?\n. . . \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nprimates.pam2 <- primates.pam2 <- as_tibble(primates.pam$Presence_and_Absence_Matrix)\n\nprimates.richness <- primates.pam2 %>% \n  mutate(richness=rowSums(primates.pam2[,-c(1:2)])) %>% \n  select(`Longitude(x)`,`Latitude(y)`,richness) %>% \n  filter(richness>0)\n\n\ntemp2 <- extract(temp, primates.pam2[,1:2])\n```\n:::\n\n\n##\nAhora ya podemos evaluar la relación entre riqueza y temperatura\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(primates.richness$richness~temp2$bio1)\n```\n\n::: {.cell-output-display}\n![](5-gradiente_riqueza_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(temp2$bio1, primates.richness$richness, method=\"spearman\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  temp2$bio1 and primates.richness$richness\nS = 1.0509e+10, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n     rho \n0.188953 \n```\n:::\n:::",
    "supporting": [
      "5-gradiente_riqueza_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}