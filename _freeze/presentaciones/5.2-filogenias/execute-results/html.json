{
  "hash": "fb7d11cd29f9598d1f06bfc865ede685",
  "result": {
    "markdown": "---\ntitle: \"Filogenias en R\"\nauthor: Axel Arango & Fabricio Villalobos & Juliana Herrera\nformat: revealjs\n---\n\n\n## Filogenias en R\n\n\n::: {.cell}\n\n:::\n\n. . .\nPrimero, ¿Qué es un árbol Filogenético?\n\n. . .\n\n-   Un árbol filogenético es un diagrama que muestra la relación de parentesco entre especies (o taxones)\n\n-   Uno de los formatos más utilizados para representar filogenias son el *Newick*(.tree)\n\n-   El formato Newick es una notación para representar parentescos utilizando paréntesis y comas.\n\n\n## \n\n-   Si queremos decir que A y B se parecen más entre ellos que con X, lo anotaríamos así:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\"((A,B),X);\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"((A,B),X);\"\n```\n:::\n:::\n\n\n## \n\nPara que *R* pueda identificar está notación, se puede usar `ape`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ape)\nread.tree(text=\"((A,B),X);\") %>% plot()\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/newick-1.png){width=960}\n:::\n:::\n\n\n## \n\nEl formato Newick es anidado, por lo que podemos explorar la relación entre diferentes grupos. Por ejemplo:\n\nSabemos que los lobos, los coyotes y los zorros pertenecen a Canidae, pero que los lobos y los coyotes son del mismo género\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCanidae <-\"(Vulpes_vulpes,(Canis_lupus,Canis_latrans));\"\nread.tree(text=Canidae) %>% plot()\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n## \n\nY si agregamos murciélagos, todos ellos pertenecen a los mamíferos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMammalia <-\"(Desmodus_rotundus,(Vulpes_vulpes,(Canis_lupus,Canis_latrans)));\"\nread.tree(text=Mammalia) %>% plot()\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/murcis-1.png){width=960}\n:::\n:::\n\n\n## \n\nSi quisiéramos agregar cuervos y zanates. ¿Estos dónde irían?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntetrapoda<-\"((Quiscalus_mexicanus,Corvus_corax),(Desmodus_rotundus,(Vulpes_vulpes,(Canis_lupus,Canis_latrans))));\"\n\nread.tree(text=tetrapoda) %>% plot()\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/zan-1.png){width=960}\n:::\n:::\n\n\n## \n\nY si agregamos una planta, los mamíferos y las aves se anidarían.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEukarya<-\"(Sideroxylon_celastrinum,((Quiscalus_mexicanus,Corvus_corax),(Desmodus_rotundus,(Vulpes_vulpes,(Canis_lupus,Canis_latrans)))));\"\n\nNktree<-read.tree(text=Eukarya) \nplot(Nktree)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/planta-1.png){width=960}\n:::\n:::\n\n\n## \n\n-   En este ejercicio haremos uso del paquete `ggtree` para graficar, personalizar, anotar y en general mejorar árboles filogenéticos\n\n## Paquetes necesarios:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ape)\nlibrary(ggtree)\nlibrary(deeptime)\nlibrary(tidytree)\nlibrary(ggimage)\nlibrary(geiger)\nlibrary(caper)\nlibrary(TDbook)\nlibrary(here)\n```\n:::\n\n\n## Filogenia *Pimelodidae*\n\nEn este ejercicio utilizaremos una filogenia con las especies del Orden Siluriforme a las cuales se le conoce su tipo de migración. Esto es un subset de la Megafilogenia para peces propuesta por Rabosky (2018)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfishtree <-read.tree(here(\"data\",\"treefish.txt\"))\nfishdata<-read.table(here(\"data\",\"DataFish.txt\"))\n```\n:::\n\n\n## \n\nVeamos esta filogenia graficándola, usando `ape`, la manera base para R.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(fishtree, show.tip.label=F)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## \n\nAhora graficaremos el mismo árbol utilizando ggtree, el cual sigue una formula idéntica a la de ggplot. Nuestro árbol base se llamará **p1**:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1<-ggtree(fishtree,color=\"black\",size=0.5)\nplot(p1)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## \n\nCon **p1**, al igual que con cualquier otro gráfico de `ggplot`, podemos agregar parámetros gráficos para personalizar o agregar anotaciones a nuestra filogenia. Primero empezaremos con los parámetros de personalización. Por ejemplo, podemos cambiar la disposición de la filogenia utilizando el parámetro `layout_`:\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\np1+layout_dendrogram()+\np1+layout_fan()+\np1+layout_circular()\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## \n\nTambién podemos cambiar el color del fondo del gráfico\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+  theme_tree(bgcolor=\"gray\")\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## Etiquetas y formas en tips\n\nAgregar las etiquetas para las puntas de una manera personalizable:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(NA, 110)+geom_tiplab(size=2,color=\"red\",angle=0)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## \n\nformas a las puntas:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+geom_tippoint(size=3,color=\"black\",fill=\"skyblue\",shape=21)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## Etiquetasy formas en nodos\n\nEtiquetas a los nodos:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+geom_nodelab(aes(label=node),size=2,color=\"blue\", hjust=-0.6)+\n  geom_nodelab(aes(subset = (node == 109), label = \"*\"),color = \"red\",size=10,hjust=1)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## \n\no formas a los nodos:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+geom_nodelab(aes(label=node),size=2,color=\"blue\", hjust=-0.6)+ geom_nodelab(aes(subset = (node == 109), label = \"*\"),color = \"red\",size=10,hjust=1)+\n  geom_nodepoint(size=2,color=\"red\",fill=\"black\",shape=21)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-15-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## Escalas temporales\n\ne incluso agregar una escala temporal a la filogenia, con la ayuda del paquete `deeptime`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npy<-revts(p1)\npy+ geom_tiplab(size=2,color=\"black\",angle=0)+xlim(-100,30)+ylim(-2,70)+coord_geo(abbrv = T,neg=T,skip=NULL,dat=\"epochs\",size=2)+theme_tree2(axis.text.x=element_blank())+guides(x = \"none\")\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## Juntar varios parametros en `ggtree`\n\nCómo en ggplot, todos estos parámetros son aditivos, por lo cual puedes construir la filogenia de manera gradual\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1+ layout_circular()+xlim(NA,150)+geom_tiplab(size=2,color=\"darkblue\")+\n  geom_tippoint(size=1,color=\"brown\",shape=10)+\n  geom_nodelab(size=1,color=\"purple\")+\n  geom_nodepoint(size=2,color=\"red\",alpha=0.3,shape=16)\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n## Anotaciones en Árboles\n\nAhora para la anotación de los árboles, se pueden hacer varias cosas, por ejemplo, quiero seleccionar la parte de la filogenia donde se encuentra las especies de la Familia *Pimelodidae*\n\n## Obtener nodos\n\nPara esto primero debemos encontrar el nodo del ancestro en común más reciente para este grupo. Usando un *tibble* y la estructura de `dplyr` es muy fácil\n\nDespués usando la función `getMRCA()` podemos encontrar el ancestro en común de estas especies\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfishdata$sciname<-row.names(fishdata)\npimelo<-fishdata %>% filter(Family==\"Pimelodidae\")\n\nnodepimelo<-getMRCA(fishtree,pimelo$sciname)\nnodepimelo\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 80\n```\n:::\n:::\n\n\n. . .\n\n## \n\nAhora sabiendo que el ancestro en común de la familia *Pimelodidae* se encuentra en el nodo 80, puedo utilizar esta información para anotar la filogenia utilizando el parámetro *geom_cladelab*:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(NA, 110)+ geom_cladelab(node=nodepimelo,label = \"Pimelodidae\",offset=0,barcolor=\"red\",textcolor=\"red\",angle=0, offset.text=0.1)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-20-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\ny que tal si identificamos varias familias:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nSiluridae<-fishdata %>% filter(Family==\"Siluridae\") %>% dplyr::select(sciname)\nnodesiluri<-getMRCA (fishtree,Siluridae$sciname)\nLoricariidae<-fishdata %>% filter(Family==\"Loricariidae\") %>% dplyr::select(sciname)\nnodelori<-getMRCA (fishtree,Loricariidae$sciname)\nBagriidae<-fishdata %>% filter(Family==\"Bagridae\") %>% dplyr::select(sciname)\nnodeBagri<-getMRCA (fishtree,Bagriidae$sciname)\n```\n:::\n\n\n## \n\nAhora podemos jugar con varios parámetros gráficos\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(NA, 110)+\n  geom_cladelab(node=nodepimelo,label =\"Pimelodidae\",offset=0,barcolor=\"red\",textcolor=\"brown\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodesiluri,label=\"Siluridae\",offset=0,barcolor=\"blue\",textcolor=\"blue\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodelori,label=\"Loricariidae\",offset=0,barcolor=\"green\",textcolor=\"green\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodeBagri,label = \"Bagridae\",offset=0,barcolor=\"black\",textcolor=\"black\",angle=0, offset.text=0.1)\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(NA, 110)+\n  geom_cladelab(node=nodepimelo,label =\"Pimelodidae\",offset=0,barcolor=\"red\",textcolor=\"brown\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodesiluri,label=\"Siluridae\",offset=0,barcolor=\"blue\",textcolor=\"blue\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodelori,label=\"Loricariidae\",offset=0,barcolor=\"green\",textcolor=\"green\",angle=0,offset.text=0.1)+\n  geom_cladelab(node=nodeBagri,label = \"Bagridae\",offset=0,barcolor=\"black\",textcolor=\"black\",angle=0, offset.text=0.1)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-24-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n. . .\n\n## \n\nTambién podemos modificar parámetros gráficos de las anotaciones.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(NA, 110)+ geom_cladelab(node=nodeBagri,label=\"Bagridae\",geom=\"label\",fill=\"skyblue\",textcolor=\"black\", barcolor=\"gray\",angle=90)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-25-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\nTambién podemos realizar una anotación entre dos taxa, que pudieran o no estar relacionados, utilizando el parámetro `geom_strip()`:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+xlim(0,120)+\n  geom_strip(\"Neoarius_graeffei\",\"Gogo_arcuatus\", label=\" un clado polifilético\", barsize = 2, offset.text = 0.2)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-26-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## Resaltar\n\nOtro parámetro de anotación muy interesante es *geom_highlight*, el cual nos permite destacar clados en particular, utilizando los nodos de ancestro en común:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+ geom_highlight(node=80,alpha=0.5,fill=\"purple\",type = \"rect\")\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-27-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n¿Qué clado es este? ...\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1+\n  geom_highlight(node=80,alpha=0.5,fill=\"purple\",type = \"rect\")+\n  geom_cladelab(node=80,label = \"Pimelodiade\",offset=0,barcolor=\"#9418f2\",textcolor=\"#4c0980\", offset.text=0)+\n  xlim(0,110)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-28-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## Phylopic\n\nUna función bastante interesante de `ggtree` es que se pueden personalizar las filogenías utilizando recursos en línea como *phylopic* o enriquecerlas con imágenes propias. \n\nPara poder hacer uso de esta función, primero debemos cargar 2 paquete extra:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"rsvg\")\nlibrary(\"rphylopic\")\n```\n:::\n\n\n## \n\npodemos probar de la siguiente manera:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"575eaa51-6c9b-4d36-9881-b8463c68ebbc\"\n```\n:::\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-30-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n. . .\n\n## \n\nHacer uso de *phylopic* para personalizar las anotaciones de las filogenias requiere que primero hagamos una tabla con los nodos, el nombre de la especie o clado a los cuales vamos a anotar y el phylopic_id.\n\nEn este ejemplo utilizaré los clados *Pimelodidae*, *Siluridae*,*Loricariidae*. Encontrar los phylopic_id es fácil usando la función `phylopic_uid()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nids<-phylopic_uid(c(\"Phractocephalus hemioliopterus\",\"Siluridae\",\"Ameiurus\",\"Chaetostoma microps\"))\n```\n:::\n\n\n## \n\nCon estos ids, ya podemos crear nuestra tabla con los datos necesarios y después gráficar nuestra filogenia:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt<-data.frame(node=c(nodepimelo,nodesiluri,nodeBagri,nodelori),\n               image=ids$uid,Family=c(\"Pimelodidae\",\"Siluridae\",\"Bagridae\",\"Loricariidae\"),\n               size=c(0.1,0.1,0.1,0.05))\ndt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  node                                image       Family size\n1   80 6cb85c3d-c455-4e9f-bfa3-fa1f8bc5c0cd  Pimelodidae 0.10\n2  119 7cb387d7-9b23-4e5c-a007-2d938339cb8a    Siluridae 0.10\n3  113 7a6448e5-09c4-40c8-8378-599d7f974bfe     Bagridae 0.10\n4  128 e557aeed-4adf-4953-ad1b-45490d3d7f3d Loricariidae 0.05\n```\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n p1+ylim(-10,80)+geom_cladelab(data = dt,mapping = aes(node = node, label = Family,image = image, color = Family),geom = \"phylopic\",imagesize=dt$size, offset.text=4)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-33-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\nAdemás, usando la argumentación como en `ggplot`, podemos personalizar los colores de nuestros *phylopics*:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt$colourss=c(\"#3d5a80\",\"#98c1d9\",\"#ee6c4d\",\"#293241\")\n\np1+ylim(-10,80)+geom_cladelab(data = dt, mapping = aes(node = node, label = Family, image = image, color = Family), geom = \"phylopic\", imagecolor=dt$colourss,barcolour=dt$colourss,imagesize=dt$size,offset.text=4)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-34-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\nUtilizando las funciones que ya conocemos, podemos crear una filogenia bastante atractiva:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n p1+ylim(-10,80)+xlim(-10,120)+\n   geom_cladelab(data = dt, \n                       mapping = aes(node = node, label = Family, \n                                     image = image, color = Family), \n                       geom = \"phylopic\", \n                       imagecolor=dt$colourss,\n                       barcolour=dt$colourss,\n                       imagesize=dt$size,offset.text=5)+\n  geom_highlight(dt,mapping = aes(node = node, label = Family,color = Family),type=\"rect\",fill=dt$colourss,color=dt$colourss)+\n  geom_cladelab(node=80,label = \"Pimelodiade\",geom = \"text\",offset=0,barcolor=\"#3d5a80\",textcolor= \"#3d5a80\", offset.text=10)+\n  geom_cladelab(node=113,label = \"Bagridae\",geom = \"text\",offset=0,barcolor=\"#98c1d9\",textcolor= \"#98c1d9\", offset.text=10) +\n  geom_cladelab(node=119,label =\"Siluridae\" ,geom = \"text\",offset=0,barcolor=\"#ee6c4d\",textcolor= \"#ee6c4d\",offset.text=10)+\n  geom_cladelab(node=128,label = \"Loricarridae\",geom = \"text\",offset=0,barcolor=\"#293241\",textcolor= \"#293241\",offset.text=10)\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-36-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\nO estas:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np2<-ggtree(fishtree,layout=\"circular\",color=\"white\")+theme_tree(\"black\")\n\np3<-p2+xlim(NA,250)+geom_cladelab(data = dt,mapping = aes(node = node, label = Family, \n                                     image = image, color = Family), \n              geom = \"phylopic\", \n              barcolour=dt$colourss,\n              imagecolor=dt$colourss,\n              alpha=c(0.8,0.8,0.8,0.8),\n              imagesize=c(0.2,0.2,0.2,0.1),offset.text=c(130,120,100,100))+\n\n  geom_highlight(node=80,fill=\"#3d5a80\")+\n  geom_cladelab(node=80,label=\"Pimelodidae\",barcolor=\"#3d5a80\",textcolor=\"white\",offset.text=2, fontsize=4,angle =-30)+\n  \n  geom_highlight(node=113,fill=\"#98c1d9\")+\n  geom_cladelab(node=113,label=\"Bagridae\",barcolor=\"#98c1d9\",textcolor=\"white\",offset.text=2, fontsize=4,angle =110)+\n  \n  geom_highlight(node=119,fill=\"#ee6c4d\")+\n  geom_cladelab(node=119,label=\"Siluridae\",barcolor=\"#ee6c4d\",textcolor=\"white\",offset.text=2, fontsize=4,angle =80)+\n  \n  geom_highlight(node=128,fill=\"#293241\")+\n  geom_cladelab(node=128,label=\"Loricariidae\",barcolor=\"#293241\",textcolor=\"white\",offset.text=2,angle = 8)\n  \n\np3\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-38-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n## \n\n## Atributos en la filogenia\n\nFinalmente, se puede usar `ggtree()`, para graficar atributos de las especies en la filogenia.\n\nPara hacer esto, primero debemos cargar los atributos de los en este caso usaremos la longitud estándar máxima y el hábito migratorio:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfishdata<-read.table(here(\"data\",\"DataFish.txt\"))\n\n\nhead(fishdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                   Genus.x      Family        Order       Class\nSynodontis_contractus           Synodontis  Mochokidae Siluriformes Actinopteri\nMochokiella_paynei             Mochokiella  Mochokidae Siluriformes Actinopteri\nChiloglanis_asymetricaudalis   Chiloglanis  Mochokidae Siluriformes Actinopteri\nAtopochilus_savorgnani         Atopochilus  Mochokidae Siluriformes Actinopteri\nAmphilius_atesuensis             Amphilius Amphiliidae Siluriformes Actinopteri\nAuchenoglanis_biscutatus     Auchenoglanis Claroteidae Siluriformes Actinopteri\n                                      salinity Length        AnaCat\nSynodontis_contractus               Freshwater    9.7 Non-migratory\nMochokiella_paynei                  Freshwater    3.6 Non-migratory\nChiloglanis_asymetricaudalis        Freshwater    7.6 Non-migratory\nAtopochilus_savorgnani              Freshwater   10.5 Non-migratory\nAmphilius_atesuensis         Freshwater-Marine    9.3 Non-migratory\nAuchenoglanis_biscutatus            Freshwater   54.0 Potamodromous\n                                                    label\nSynodontis_contractus               Synodontis_contractus\nMochokiella_paynei                     Mochokiella_paynei\nChiloglanis_asymetricaudalis Chiloglanis_asymetricaudalis\nAtopochilus_savorgnani             Atopochilus_savorgnani\nAmphilius_atesuensis                 Amphilius_atesuensis\nAuchenoglanis_biscutatus         Auchenoglanis_biscutatus\n```\n:::\n:::\n\n\n## \n\nUna vez cargados los datos, la manera más fácil de utilizarlos es uniendolos a la filogenia usando la función `full_join`, es importante que las especies estén etiquetadas como label, para que la función las reconozca:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatatree<-left_join(fishtree,fishdata,by=\"label\")\n```\n:::\n\n\n## \n\n¡Listo! Ahora tenemos una filogenia con atributos y podemos graficarlos juntos\n\nPrimero graficaremos los valores continuos de la longitud sobre las puntas del árbol en una escala de colores:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np4<-ggtree(datatree)\np4+geom_tippoint(aes(color= Length),size=3)\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-41-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\npodemos también personalizar esta escala:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np4+\n  geom_tippoint(aes(color= Length),shape=19,size=3)+scale_colour_gradient(low='blue', high='red',breaks= c(15,50,100,150,200,300))\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-42-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\n¿Y cómo se verían los datos discretos?\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np4+geom_tippoint(aes(color=salinity),shape=15)+ scale_colour_manual(values = c(\"blue\",\"gray\",\"skyblue\"))\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-43-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\ny ¿Pueden combinarse?\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npx<- p4+ geom_tippoint(aes(color=salinity),shape=15)+\n  scale_color_manual(values = c(\"blue\",\"gray\",\"skyblue\"))+\n  scale_fill_manual(values = c(\"blue\",\"gray\",\"skyblue\"))\n\ndd<-data.frame(id=p4$data$label,value=p4$data$Length)  \n  \npx+ geom_facet(panel=\"Length\",data =dd[1:65,],geom=geom_col, \n               mapping=aes(x=Length,color=salinity,fill=salinity),orientation='y')+\n    theme_tree2()\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-45-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\n## \n\n`ggtreeExtra`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggtreeExtra)\n\np5<-p4+geom_tippoint(aes(colour=AnaCat))+scale_color_manual(values = c(\"#3d5a80\",\"#98c1d9\",\"#e0fbfc\",\"#293241\",\"#ee6c4d\"))\n\np5+geom_fruit(data=dd[1:65,],\n         geom=geom_bar,\n         mapping = aes(\n                     y=id,\n                     x=value,\n                     group=salinity,\n                     fill=salinity),pwidth=0.38, \n                    orientation=\"y\", \n                    stat=\"identity\",axis.params=list(\n                         axis       = \"x\",\n                         text.size  = 1.8,\n                         hjust      = 1,\n                         vjust      = 0.5,\n                         nbreak     = 3))+ scale_fill_manual(values = c(\"blue\",\"gray\",\"skyblue\"))\n```\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-47-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\nPara poder anotar las filogenias con imagenes, es recomendable usar árboles filogéticos pequeños. En este ejemplo usaremos una filogenia parafiletica con las Familias *Pimelodidae*,*Doradidae* y *Loricariidae*\n\nEntonces, primero recuperamos un representante de cada grupo, *ape* es muy bueno para esto usando la función *keep.tip*:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngrouptree<-fishtree %>%\nkeep.tip(c(\"Pimelodus_maculatus\", \"Lithodoras_dorsalis\",\"Loricariichthys_anus\"))\n\ngrouptree$tip.label<-c(\"Pimelodidae\", \"Doraridae\",\"Loricariidae\")\n\np6<-ggtree(grouptree,size=1)+xlim(0,120)+ geom_tiplab(color=\"navyblue\",offset = 0.5,size=5)\np6\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-48-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## \n\nUna vez teniendo este árbol parafilético, podemos colocar las imagenes en cada tip, es importante considerar, que las imagenes deben tener el nombre exacto del grupo o especie y el mismo formato:\n\nLas fotos aqui presentadas provienen del Proyecto `cavfish`\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-49-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## \n\nPero, ¿Qué pasa si no me sé la taxonomía o no tengo la filogenia del grupo que estoy estudiando?\n\n\n\n\n\n## \n\n¿Se acuerdan de esta filogenia?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphylopicNK\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-51-1.png){width=960}\n:::\n:::\n\n\n## \n\nHaciendo uso de recursos en línea como *Open tree of Life*(OTL), podemoos obtener una filogenia utilizando las especies que necesitemos.\n\n## \n\nOTL tiene un útil paquete en R (`rotl`),para obtener filogenia\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"rotl\")\notl_tree<-rotl::tnrs_match_names(c(\"Quiscalus mexicanus\",\"Canis lupus\",\"Corvus corax\",\"Canis latrans\",\"Vulpes vulpes\",\"Desmodus rotundus\",\"Sideroxylon celastrinum\")) %>% \n  pull(ott_id) %>% \n  tol_induced_subtree(label_format=\"name\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nProgress [---------------------------------] 0/209 (  0%) ?s\nProgress [==============================] 209/209 (100%)  0s\n                                                            \n```\n:::\n:::\n\n\n## \n\n\n::: {.cell}\n\n```{.r .cell-code}\np_ott<-ggtree(otl_tree)+\n  xlim(0,9)+\n  geom_tiplab(color=\"blue\")\np_ott\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-53-1.png){width=960}\n:::\n:::\n\n\n## \n\nPara la función de `rtol`, **NO** es necesario introducir las especies en orden, ya que ésta recuperará la taxonomia válida y nos arrojará una filogenia podada.\n\nEn este caso, OTL nos regresó exactamente la misma filogenia que creamos al principio:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np_nk<-ggtree(Nktree)+\n  xlim(0,9)+\n  geom_tiplab(color=\"red\")\n\np_ott/p_nk\n```\n\n::: {.cell-output-display}\n![](5.2-filogenias_files/figure-revealjs/unnamed-chunk-54-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## \n",
    "supporting": [
      "5.2-filogenias_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}