<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luis D. Verde Arregoitia">
<meta name="dcterms.date" content="2023-09-28">

<title>Herramientas para el manejo de datos de biodiversidad en R - Patrones ecogeográficos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Herramientas para el manejo de datos de biodiversidad en R
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Herramientas para el manejo de datos de biodiversidad en R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/luisDVA/curso-R-biodiversidad" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./temario.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Temario y cronograma</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./materiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Materiales</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#contexto-espacial" id="toc-contexto-espacial" class="nav-link active" data-scroll-target="#contexto-espacial">Contexto espacial</a>
  <ul class="collapse">
  <li><a href="#operaciones-espaciales" id="toc-operaciones-espaciales" class="nav-link" data-scroll-target="#operaciones-espaciales">Operaciones espaciales</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Patrones ecogeográficos</h1>
<p class="subtitle lead">Manejo de puntos y raster</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Luis D. Verde Arregoitia </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 28, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cargar paquetes</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)         </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.10.2, GDAL 3.4.3, PROJ 8.2.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)       </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,
which was just loaded, will retire in October 2023.
Please refer to R-spatial evolution reports for details, especially
https://r-spatial.org/r/2023/05/15/evolution4.html.
It may be desirable to make the sf package available;
package maintainers should consider adding sf to Suggests:.
The sp package is now running under evolution status 2
     (status 2 uses the sf package in place of rgdal)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)      </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: terra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)         </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: abind</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)         </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos a trabajar con datos del largo del antebrazo de las dos especies de <em>Sturnira</em> presentes en México.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importar datos directamente desde un repositorio de github </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ab_mex <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/luisDVA/SturniraMacroecology/raw/master/data/flwbiocl.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 858 Columns: 15
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): collector, species, sex, state, localityOG, locality
dbl (9): ncat, longitude, latitude, elevation, FL, AnnPrec, PETseasonality, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Las observaciones (cada fila) corresponden a un ejemplar con sus respectivos datos asociados a la localidad, incluyendo elevación y algunas variables climáticas. La variable <code>FL</code> es el largo del antebrazo, que podría estar respondiendo a factores bióticos.</p>
<p>¿Cómo se ve la relación entre el tamaño corporal (representado por FL) y la elevación?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># en R base</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(FL<span class="sc">~</span>elevation,<span class="at">data=</span>ab_mex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># con ggplot2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ab_mex)<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>elevation,<span class="at">y=</span>FL))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Recordemos que los datos incluyen dos especies distintas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ab_mex)<span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>elevation,<span class="at">y=</span>FL,<span class="at">color=</span>species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ab_mex)<span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>elevation,<span class="at">y=</span>FL,<span class="at">color=</span>species))<span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># qué tal con la temperatura mínima anual?</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ab_mex)<span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>AnnualTmin,<span class="at">y=</span>FL,<span class="at">color=</span>species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Prueben graficar distintos pares de variables.</p>
<blockquote class="blockquote">
<p>¿Cómo podríamos visualizar la relación entre elevación, temperatura, y tamaño corporal para las dos especies?</p>
</blockquote>
<section id="contexto-espacial" class="level2">
<h2 class="anchored" data-anchor-id="contexto-espacial">Contexto espacial</h2>
<p>Aprovechemos la información espacial, creando un objeto de clase <strong>simple features</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ab_mex_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ab_mex,<span class="at">coords =</span> <span class="fu">c</span>(<span class="at">X=</span><span class="st">"longitude"</span>,<span class="at">Y=</span><span class="st">"latitude"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mapa de algunos valores continuos</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ab_mex_sf[<span class="st">"sex"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ab_mex_sf[<span class="st">"elevation"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para darle contexto a los puntos, agregamos una división política</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estados de México, pedimos un objeto sf</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>divpol <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">country=</span><span class="st">"Mexico"</span>,<span class="at">returnclass =</span> <span class="st">"sf"</span>) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># podemos graficar todos los atributos o solo el contorno</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(divpol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: plotting the first 9 out of 121 attributes; use max.plot = 121 to plot
all</code></pre>
</div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(divpol))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>¿Cómo ponemos los puntos y polígonos en un mismo mapa?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># especificando el objeto en cada 'geom' que estamos pidiendo</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>divpol)<span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>ab_mex_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in st_transform.sfc(X[[i]], ...): cannot transform sfc object with missing crs</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>😿 por qué no anda ??</p>
</blockquote>
<p>Hay que especificar el sistema de coordenadas. Sabiendo que usan el mismo, le asignamos el crs de la división política a los puntos de las localidades</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ab_mex_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ab_mex,<span class="at">coords =</span> <span class="fu">c</span>(<span class="at">X=</span><span class="st">"longitude"</span>,<span class="at">Y=</span><span class="st">"latitude"</span>),<span class="at">crs=</span><span class="fu">st_crs</span>(divpol))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora sí</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>divpol)<span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>ab_mex_sf)<span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="operaciones-espaciales" class="level3">
<h3 class="anchored" data-anchor-id="operaciones-espaciales">Operaciones espaciales</h3>
<p>El archivo descargado ya tenía valores de variables ambientales para cada punto, pero también podemos extraer este tipo de datos de cualquier capa raster.</p>
<p>Similar a lo que ya hicieron en otras sesiones, vamos a descargar datos de WorldClim a nuestra carpeta de trabajo usando el paquete <code>geodata</code>, que viene a reemplazar la función <code>getData</code>. En este caso descargaremos capas mensuales de temperatura mínima.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># se puede acotar la descarga al 'bounding box' de un país</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tminrast <span class="ot">&lt;-</span> <span class="fu">worldclim_country</span>(<span class="st">"Mexico"</span>, <span class="at">var=</span> <span class="st">"tmin"</span>,<span class="at">res=</span><span class="fl">2.5</span>, <span class="at">path=</span><span class="fu">tempdir</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El objeto <code>tminrast</code> es de clase <em>SpatRaster</em> (una sección rectangular del mundo que a su vez está subdividad en celdas rectangulares, todas de con la misma área)</p>
<p>Exploren el objeto <code>tminrast</code>. ¿Qué es y cómo lo usarían?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tminrast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 2220, 3840, 12  (nrow, ncol, nlyr)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : -118.5, -86.5, 14.5, 33  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source      : MEX_wc2.1_30s_tmin.tif 
names       : MEX_w~min_1, MEX_w~min_2, MEX_w~min_3, MEX_w~min_4, MEX_w~min_5, MEX_w~min_6, ... 
min values  :        -8.4,        -6.9,        -5.8,        -3.7,        -3.3,        -2.8, ... 
max values  :        23.5,        23.7,        24.5,        25.8,        26.6,        26.9, ... </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tminrast[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 2220, 3840, 1  (nrow, ncol, nlyr)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : -118.5, -86.5, 14.5, 33  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source      : MEX_wc2.1_30s_tmin.tif 
name        : MEX_wc2.1_30s_tmin_1 
min value   :                 -8.4 
max value   :                 23.5 </code></pre>
</div>
</div>
<p>Podemos promediar espacialmente los valores de cada mes en cada pixel</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># el método mean ya está implementado para objetos SpatRaster con varias capas</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tminpromedio <span class="ot">&lt;-</span> <span class="fu">mean</span>(tminrast)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>tminpromedio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 2220, 3840, 1  (nrow, ncol, nlyr)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : -118.5, -86.5, 14.5, 33  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source(s)   : memory
name        :     mean 
min value   : -3.85000 
max value   : 25.44167 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># salió??</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tminpromedio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>tminpromedio[<span class="dv">2000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean
1 8.05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tminpromedio[<span class="dv">2000</span>] <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.05</code></pre>
</div>
</div>
<p>Teniendo una sola capa nueva, podemos extraer los valores en los que están los puntos de las localidades</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract</span>(tminpromedio,ab_mex_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ID      mean
1     1 18.650000
2     2 18.650000
3     3 18.650000
4     4 18.650000
5     5 18.650000
6     6 12.908333
7     7 12.908333
8     8 12.908333
9     9 12.908333
10   10 15.166667
11   11 12.908333
12   12 12.908333
13   13 15.433333
14   14 16.533333
15   15 12.908333
16   16 12.908333
17   17 12.908333
18   18 12.908333
19   19 12.908333
20   20 12.908333
21   21 12.908333
22   22 12.741667
23   23 15.166667
24   24 15.166667
25   25 15.166667
26   26 15.166667
27   27 12.741667
28   28 20.316667
29   29 15.166667
30   30 19.675000
31   31 20.275000
32   32 10.675000
33   33 10.075000
34   34 10.675000
35   35 15.925000
36   36 15.925000
37   37 13.091667
38   38 13.091667
39   39 12.741667
40   40 12.741667
41   41 13.091667
42   42 13.091667
43   43 13.891667
44   44 15.391667
45   45 13.100000
46   46 12.700000
47   47 15.391667
48   48 13.100000
49   49 15.391667
50   50 15.391667
51   51 12.791667
52   52 15.391667
53   53 12.741667
54   54 13.100000
55   55 15.391667
56   56 14.500000
57   57 15.391667
58   58 12.758333
59   59 12.758333
60   60 15.391667
61   61 12.741667
62   62 15.391667
63   63 15.391667
64   64 15.391667
65   65 13.891667
66   66 13.091667
67   67 15.391667
68   68 15.391667
69   69 15.391667
70   70 15.391667
71   71 15.391667
72   72 15.391667
73   73 11.066667
74   74 13.100000
75   75 15.391667
76   76 15.391667
77   77 15.391667
78   78 12.791667
79   79 12.741667
80   80 12.841667
81   81 12.741667
82   82 12.758333
83   83 11.066667
84   84 13.891667
85   85 11.066667
86   86 11.066667
87   87 13.091667
88   88 15.391667
89   89 15.391667
90   90 13.100000
91   91 13.100000
92   92 13.891667
93   93 13.091667
94   94 13.091667
95   95 11.066667
96   96 15.391667
97   97 10.891667
98   98 10.891667
99   99 10.891667
100 100 13.091667
101 101 15.941667
102 102 15.391667
103 103 15.391667
104 104 15.391667
105 105 15.391667
106 106 13.100000
107 107 15.391667
108 108 12.791667
109 109 12.841667
110 110 14.500000
111 111 15.391667
112 112 15.391667
113 113 12.608333
114 114 15.391667
115 115 12.741667
116 116 15.391667
117 117 13.100000
118 118 12.791667
119 119 13.100000
120 120 15.391667
121 121 15.391667
122 122 15.391667
123 123 15.391667
124 124 15.391667
125 125 15.391667
126 126 15.391667
127 127 15.391667
128 128 13.100000
129 129 15.391667
130 130 15.391667
131 131 15.941667
132 132 13.891667
133 133 15.391667
134 134 13.100000
135 135 15.391667
136 136 11.066667
137 137 15.391667
138 138 13.091667
139 139 13.891667
140 140 13.891667
141 141 18.116666
142 142 17.666667
143 143 18.116666
144 144 18.116666
145 145 17.666667
146 146 18.116666
147 147 18.116666
148 148 18.116666
149 149 18.116666
150 150 17.116667
151 151 17.116667
152 152 17.116667
153 153 17.116667
154 154 16.691667
155 155 17.116667
156 156 17.666667
157 157 16.691667
158 158 17.666667
159 159 17.666667
160 160 17.666667
161 161 17.666667
162 162 18.483333
163 163 18.833333
164 164 19.675000
165 165 19.916667
166 166 19.916667
167 167 19.750000
168 168 19.675000
169 169 19.675000
170 170 11.850000
171 171 17.116667
172 172 10.675000
173 173 16.691667
174 174 11.541667
175 175 10.675000
176 176 10.675000
177 177 10.675000
178 178 13.725000
179 179 12.050000
180 180 16.691667
181 181 17.116667
182 182 16.691667
183 183 10.675000
184 184 10.675000
185 185 16.691667
186 186 10.675000
187 187 10.675000
188 188 16.691667
189 189 10.675000
190 190 10.675000
191 191 10.675000
192 192 10.675000
193 193 15.866667
194 194 10.675000
195 195 10.675000
196 196 16.691667
197 197 10.675000
198 198 17.666667
199 199 15.866667
200 200 10.675000
201 201 10.675000
202 202 12.908333
203 203 10.675000
204 204 10.675000
205 205 10.675000
206 206 12.050000
207 207 12.050000
208 208 11.391667
209 209 11.908333
210 210 12.050000
211 211 10.675000
212 212 11.908333
213 213 11.541667
214 214 11.391667
215 215 11.391667
216 216 12.050000
217 217 11.391667
218 218 12.050000
219 219 12.050000
220 220 11.908333
221 221 11.908333
222 222 11.908333
223 223 11.908333
224 224 11.908333
225 225 12.050000
226 226 11.391667
227 227 11.908333
228 228 10.675000
229 229 10.675000
230 230 16.691667
231 231 16.691667
232 232 10.675000
233 233 10.675000
234 234 10.675000
235 235 10.675000
236 236 10.675000
237 237 10.675000
238 238 16.691667
239 239 10.675000
240 240 10.675000
241 241 10.675000
242 242 10.675000
243 243 10.675000
244 244 10.675000
245 245 10.675000
246 246 10.675000
247 247 10.675000
248 248 10.675000
249 249 10.675000
250 250 10.675000
251 251 10.675000
252 252 15.133333
253 253 16.600000
254 254 11.633333
255 255 11.200000
256 256 11.541667
257 257 14.466667
258 258 14.466667
259 259 16.600000
260 260 17.825000
261 261 18.166667
262 262 18.166667
263 263 15.391667
264 264 15.391667
265 265 15.391667
266 266 11.741667
267 267 10.241667
268 268 10.241667
269 269  9.108333
270 270 10.241667
271 271 13.741667
272 272 13.475000
273 273 20.375000
274 274 11.033333
275 275 11.033333
276 276 11.033333
277 277 11.033333
278 278 11.033333
279 279 11.033333
280 280 11.033333
281 281 11.033333
282 282 11.033333
283 283 14.000000
284 284 11.050000
285 285 11.050000
286 286 14.341667
287 287 12.700000
288 288 12.700000
289 289 12.700000
290 290 15.191667
291 291 15.191667
292 292 18.483333
293 293 18.625000
294 294 20.833333
295 295 13.225000
296 296 19.250000
297 297 19.250000
298 298 19.250000
299 299 19.250000
300 300 19.250000
301 301 19.250000
302 302 19.250000
303 303 19.250000
304 304 19.250000
305 305 15.658333
306 306 15.658333
307 307 15.658333
308 308 15.658333
309 309 15.658333
310 310 15.658333
311 311 20.266667
312 312 19.933334
313 313 20.266667
314 314 18.925000
315 315 19.250000
316 316 15.350000
317 317 15.350000
318 318 16.900000
319 319  6.616667
320 320 15.350000
321 321 15.350000
322 322 15.350000
323 323  6.616667
324 324  6.616667
325 325 15.350000
326 326  6.616667
327 327  6.616667
328 328 12.650000
329 329 12.650000
330 330  6.616667
331 331  6.616667
332 332  6.616667
333 333 15.350000
334 334 15.350000
335 335  6.616667
336 336  6.616667
337 337 12.650000
338 338 12.650000
339 339 12.650000
340 340 15.350000
341 341 15.350000
342 342 15.350000
343 343 15.350000
344 344 15.350000
345 345 15.350000
346 346 15.350000
347 347 15.350000
348 348 15.350000
349 349 15.350000
350 350 15.350000
351 351 15.350000
352 352  6.616667
353 353  6.616667
354 354 11.025000
355 355  6.616667
356 356  6.616667
357 357  6.616667
358 358  6.616667
359 359 16.900000
360 360 19.250000
361 361 14.466667
362 362  8.875000
363 363  8.875000
364 364  8.875000
365 365  8.875000
366 366  8.875000
367 367  8.625000
368 368  8.875000
369 369  8.875000
370 370  8.875000
371 371  8.875000
372 372  8.875000
373 373  8.875000
374 374  8.875000
375 375  8.875000
376 376  8.875000
377 377  8.875000
378 378 15.866667
379 379 11.908333
380 380 11.908333
381 381 11.908333
382 382 15.658333
383 383 11.175000
384 384 11.175000
385 385 11.175000
386 386 11.175000
387 387 11.175000
388 388 11.175000
389 389 11.175000
390 390 14.475000
391 391  9.550000
392 392 10.041667
393 393 12.250000
394 394 12.250000
395 395 12.250000
396 396 16.391667
397 397 16.800000
398 398 12.250000
399 399 12.250000
400 400 16.800000
401 401 16.800000
402 402 12.250000
403 403 16.391667
404 404 14.733333
405 405 12.958333
406 406 12.133333
407 407 12.133333
408 408 14.750000
409 409 18.341667
410 410 13.600000
411 411 13.091667
412 412 16.358333
413 413 19.250000
414 414 19.250000
415 415 18.225000
416 416 11.833333
417 417 19.516666
418 418 19.516666
419 419 19.758334
420 420 19.516666
421 421 19.758334
422 422 20.108333
423 423 19.758334
424 424 20.108333
425 425 19.758334
426 426 19.758334
427 427 16.900000
428 428 19.933334
429 429 13.341667
430 430 13.341667
431 431 19.133333
432 432 13.341667
433 433 13.341667
434 434 16.358333
435 435 13.341667
436 436 16.358333
437 437 14.941667
438 438 10.541667
439 439 14.475000
440 440 10.541667
441 441 11.033333
442 442 10.541667
443 443 14.941667
444 444 16.133333
445 445 16.133333
446 446 11.908333
447 447 11.075000
448 448 16.358333
449 449 10.541667
450 450  9.475000
451 451 11.158333
452 452 10.541667
453 453 10.541667
454 454  7.475000
455 455 10.891667
456 456 13.341667
457 457 20.550000
458 458 20.550000
459 459 20.550000
460 460 20.550000
461 461 20.550000
462 462 20.550000
463 463 20.550000
464 464 20.550000
465 465 19.000000
466 466 19.000000
467 467 19.000000
468 468 19.000000
469 469 19.000000
470 470 20.550000
471 471 20.550000
472 472 19.000000
473 473 19.000000
474 474 19.000000
475 475 20.383333
476 476 19.516666
477 477 18.358333
478 478 14.475000
479 479 16.900000
480 480 18.225000
481 481 14.941667
482 482  8.975000
483 483 14.941667
484 484  8.975000
485 485  8.875000
486 486 10.541667
487 487 20.358333
488 488 20.358333
489 489 20.358333
490 490 20.358333
491 491 20.358333
492 492 20.258333
493 493 20.258333
494 494 20.258333
495 495 20.258333
496 496 20.358333
497 497 20.358333
498 498 20.358333
499 499 16.125000
500 500 12.483333
501 501 16.125000
502 502 16.125000
503 503 16.125000
504 504 12.483333
505 505 12.483333
506 506 11.491667
507 507 12.483333
508 508 15.541667
509 509 15.541667
510 510 15.541667
511 511 15.541667
512 512 15.541667
513 513 15.541667
514 514 15.541667
515 515 15.541667
516 516 15.508333
517 517 15.508333
518 518 15.508333
519 519  8.125000
520 520  8.125000
521 521  8.125000
522 522  7.025000
523 523 20.800000
524 524 11.975000
525 525 11.975000
526 526 11.975000
527 527 11.975000
528 528 11.975000
529 529 11.975000
530 530 15.508333
531 531 18.025000
532 532 15.508333
533 533 15.508333
534 534 18.025000
535 535 20.375000
536 536 15.508333
537 537  9.166667
538 538 16.941667
539 539 15.508333
540 540 15.508333
541 541 15.508333
542 542 16.333334
543 543 16.333334
544 544 16.941667
545 545 10.075000
546 546 16.941667
547 547 11.750000
548 548 11.750000
549 549 11.750000
550 550 15.475000
551 551 15.475000
552 552 10.541667
553 553 15.541667
554 554 15.541667
555 555 18.258333
556 556 15.241667
557 557 15.241667
558 558 15.241667
559 559 15.241667
560 560 15.241667
561 561 15.241667
562 562 15.241667
563 563 15.241667
564 564 15.241667
565 565 15.241667
566 566  8.325000
567 567  8.325000
568 568  8.325000
569 569  8.325000
570 570 20.341667
571 571 10.066667
572 572 21.275000
573 573 21.275000
574 574 11.750000
575 575 11.750000
576 576 11.750000
577 577 11.750000
578 578 11.750000
579 579 11.016667
580 580  8.325000
581 581 11.016667
582 582  8.325000
583 583  8.325000
584 584  8.325000
585 585  8.325000
586 586 10.383333
587 587 18.450000
588 588  9.475000
589 589 17.475000
590 590 17.475000
591 591 19.483333
592 592 19.483333
593 593  8.325000
594 594  8.325000
595 595  8.325000
596 596  8.325000
597 597  8.325000
598 598 20.383333
599 599 10.541667
600 600 10.541667
601 601 10.541667
602 602 17.216667
603 603 13.550000
604 604 13.550000
605 605 13.550000
606 606 13.550000
607 607 17.216667
608 608 16.116667
609 609 14.658333
610 610 14.991666
611 611 14.991666
612 612 18.541667
613 613 16.858333
614 614 16.858333
615 615 16.858333
616 616 16.066667
617 617 16.066667
618 618 16.066667
619 619 16.066667
620 620 14.800000
621 621 14.800000
622 622 15.758333
623 623 14.800000
624 624 15.758333
625 625 15.758333
626 626 15.758333
627 627 18.591667
628 628 18.541667
629 629 16.525000
630 630 14.800000
631 631 14.991666
632 632 19.750000
633 633 14.991666
634 634 14.991666
635 635 19.750000
636 636 10.858333
637 637 14.650000
638 638 14.650000
639 639 14.650000
640 640 14.650000
641 641 14.341667
642 642 14.341667
643 643 14.341667
644 644 14.341667
645 645 14.341667
646 646 14.341667
647 647 14.650000
648 648 14.650000
649 649 14.650000
650 650 13.758333
651 651 14.341667
652 652 14.341667
653 653 14.341667
654 654 14.341667
655 655 14.341667
656 656 14.650000
657 657 14.650000
658 658 14.650000
659 659 14.650000
660 660 14.650000
661 661 14.650000
662 662 13.758333
663 663 13.758333
664 664 13.758333
665 665 14.650000
666 666 13.758333
667 667 13.758333
668 668 13.758333
669 669 13.758333
670 670 14.650000
671 671 14.650000
672 672 14.650000
673 673 14.650000
674 674 14.650000
675 675 14.341667
676 676 13.758333
677 677 14.650000
678 678 14.650000
679 679 14.650000
680 680 14.650000
681 681 14.650000
682 682 14.650000
683 683 14.650000
684 684 14.650000
685 685 14.650000
686 686 14.341667
687 687 14.650000
688 688 14.650000
689 689 14.650000
690 690 14.650000
691 691 14.650000
692 692 14.650000
693 693 14.650000
694 694 18.441667
695 695 18.441667
696 696 18.441667
697 697 18.441667
698 698 18.441667
699 699 18.441667
700 700 18.441667
701 701 18.441667
702 702 18.441667
703 703 18.441667
704 704 21.350000
705 705 21.350000
706 706 18.441667
707 707 21.350000
708 708 21.350000
709 709 18.916667
710 710 21.350000
711 711 18.916667
712 712 18.916667
713 713 18.916667
714 714  9.191667
715 715  9.191667
716 716 19.750000
717 717 19.750000
718 718 14.808333
719 719 13.983334
720 720 17.958333
721 721  8.500000
722 722  9.758333
723 723  9.758333
724 724  9.758333
725 725  9.758333
726 726  9.758333
727 727  9.758333
728 728  9.758333
729 729  9.758333
730 730  5.433333
731 731  5.433333
732 732  5.433333
733 733  5.758333
734 734  5.758333
735 735  5.758333
736 736  5.758333
737 737  5.758333
738 738  5.758333
739 739  5.758333
740 740  8.858333
741 741  8.858333
742 742  8.858333
743 743 10.333333
744 744 10.333333
745 745  9.758333
746 746  9.758333
747 747  9.758333
748 748  9.758333
749 749  9.758333
750 750  9.758333
751 751  8.500000
752 752 18.366667
753 753 14.991666
754 754 17.216667
755 755 15.191667
756 756 16.250000
757 757 16.250000
758 758 16.250000
759 759 16.250000
760 760 10.891667
761 761  9.166667
762 762  9.116667
763 763  9.116667
764 764  7.475000
765 765  7.475000
766 766 20.041667
767 767 20.041667
768 768 13.233333
769 769 13.233333
770 770 13.233333
771 771 13.233333
772 772 13.233333
773 773 13.233333
774 774 12.966667
775 775 13.233333
776 776 13.233333
777 777 13.233333
778 778 11.966667
779 779 11.966667
780 780 16.316667
781 781 20.400000
782 782 11.966667
783 783 10.475000
784 784 10.475000
785 785  9.791667
786 786  9.791667
787 787  9.791667
788 788  9.791667
789 789 20.891666
790 790 15.441667
791 791 20.800000
792 792 20.800000
793 793 20.800000
794 794 14.650000
795 795 12.516667
796 796 12.516667
797 797 12.516667
798 798 12.516667
799 799 12.516667
800 800 12.516667
801 801 12.516667
802 802 12.516667
803 803 12.516667
804 804 12.533333
805 805 12.533333
806 806 12.533333
807 807 10.475000
808 808 10.475000
809 809  9.541667
810 810 12.533333
811 811 10.475000
812 812 10.475000
813 813 10.475000
814 814 12.533333
815 815 12.516667
816 816 10.475000
817 817 10.475000
818 818  7.175000
819 819 10.475000
820 820 12.516667
821 821 20.891666
822 822 20.891666
823 823 20.891666
824 824 19.133333
825 825 19.133333
826 826 19.133333
827 827 19.133333
828 828 19.133333
829 829 13.058333
830 830 13.058333
831 831 13.058333
832 832 13.058333
833 833 13.058333
834 834 13.058333
835 835 13.058333
836 836 13.058333
837 837 16.016667
838 838 16.016667
839 839 16.016667
840 840 16.016667
841 841 16.016667
842 842 16.016667
843 843 16.016667
844 844 16.016667
845 845 16.133333
846 846 16.133333
847 847 16.133333
848 848 12.325000
849 849 12.325000
850 850 12.325000
851 851 12.325000
852 852 12.325000
853 853 12.325000
854 854 12.325000
855 855 12.325000
856 856 12.325000
857 857 12.325000
858 858 14.991667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ab_mex<span class="sc">$</span>tminNuevo <span class="ot">&lt;-</span> <span class="fu">extract</span>(tminpromedio,ab_mex_sf)<span class="sc">$</span>mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tminrast[<span class="dv">2000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MEX_wc2.1_30s_tmin_1 MEX_wc2.1_30s_tmin_2 MEX_wc2.1_30s_tmin_3
1                 -3.3                 -1.1                  2.4
  MEX_wc2.1_30s_tmin_4 MEX_wc2.1_30s_tmin_5 MEX_wc2.1_30s_tmin_6
1                  7.2                 12.7                 17.3
  MEX_wc2.1_30s_tmin_7 MEX_wc2.1_30s_tmin_8 MEX_wc2.1_30s_tmin_9
1                 19.3                 18.6                   15
  MEX_wc2.1_30s_tmin_10 MEX_wc2.1_30s_tmin_11 MEX_wc2.1_30s_tmin_12
1                   8.8                     2                  -2.3</code></pre>
</div>
</div>
<p>Ahora es posible comparar los valores de TMin presentes en la tabla con los recién extraidos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ab_mex)<span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(tminNuevo,AnnualTmin<span class="sc">/</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>¿Qué podría explicar las diferencias?</p>
<p>También es posible extraer valores en</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>guerrero_poly <span class="ot">&lt;-</span> divpol <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name<span class="sc">==</span><span class="st">"Guerrero"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>pts_guerrero <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(guerrero_poly,ab_mex_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>buf_pts_guerrero <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(pts_guerrero,<span class="at">dist =</span> <span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>pts_guerrero)<span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>buf_pts_guerrero)<span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guerrero_poly,<span class="at">fill=</span><span class="st">"transparent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>limsGuerr <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(guerrero_poly)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Grast <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="at">xmin=</span>limsGuerr<span class="sc">$</span>xmin,<span class="at">xmax=</span>limsGuerr<span class="sc">$</span>xmax,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ymin=</span>limsGuerr<span class="sc">$</span>ymin,<span class="at">ymax=</span>limsGuerr<span class="sc">$</span>ymax,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ncols=</span><span class="dv">50</span>,<span class="at">nrows=</span><span class="dv">50</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">crs=</span><span class="fu">crs</span>(guerrero_poly))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Grast) <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="dv">2500</span>,<span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Grast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">cov_veg=</span><span class="fu">c</span>(<span class="st">"bosque"</span>, <span class="st">"urbano"</span>, <span class="st">"cultivo"</span>,<span class="st">"mixto"</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Grast) <span class="ot">&lt;-</span> cls</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>GrastStars <span class="ot">&lt;-</span> <span class="fu">st_as_stars</span>(Grast)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>GrastStars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
    cov_veg   
 bosque :643  
 urbano :649  
 cultivo:603  
 mixto  :605  
dimension(s):
  from to  offset      delta refsys x/y
x    1 50 -102.18  0.0835567 WGS 84 [x]
y    1 50 18.8706 -0.0510471 WGS 84 [y]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data=</span>GrastStars)<span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>buf_pts_guerrero,<span class="at">linewidth=</span><span class="fl">0.9</span>,<span class="at">fill=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>guerrero_poly,<span class="at">fill=</span><span class="st">"transparent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="claseMacroSept2023_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>buffer_areas <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_extract</span>(Grast, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>             buf_pts_guerrero,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">coverage_area=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>proporciones <span class="ot">&lt;-</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>buffer_areas <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(<span class="at">.id=</span><span class="st">"punto"</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(punto,value) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_area =</span> <span class="fu">sum</span>(coverage_area)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">prop =</span> total_area<span class="sc">/</span><span class="fu">sum</span>(total_area)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">levels</span>(Grast)[[<span class="dv">1</span>]],<span class="at">by=</span><span class="fu">c</span>(<span class="st">"value"</span><span class="ot">=</span><span class="st">"id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'punto'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Página creada con <a href="https://quarto.org/">Quarto</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Luis D. Verde Arregoitia - 2023</div>
  </div>
</footer>



</body></html>